{"version":3,"sources":["../lib/ride.js"],"names":["Schedule","require","Moment","s_rideID","Symbol","s_rideName","s_currentWaitTime","s_fastPassAvailable","s_lastTimeUpdate","s_scheduleData","Ride","options","ride_id","ride_name","Error","openingHours","GetDate","date","jsonData","id","name","Name","active","Active","waitTime","WaitTime","fastPass","FastPass","lastUpdate","LastUpdate","status","Status","schedule","rideData","SetDate","special","length","i","specialSchedule","openingTime","closingTime","type","specialHours","value","undefined","Date","now","todaysSchedule","module","exports"],"mappings":"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","file":"ride.js","sourcesContent":["// our schedule library\r\nvar Schedule = require(\"./schedule\");\r\nvar Moment = require(\"moment-timezone\");\r\n\r\n// symbols\r\nvar s_rideID = Symbol();\r\nvar s_rideName = Symbol();\r\nvar s_currentWaitTime = Symbol();\r\nvar s_fastPassAvailable = Symbol();\r\nvar s_lastTimeUpdate = Symbol();\r\nvar s_scheduleData = Symbol();\r\n\r\n/**\r\n * @typedef RideData\r\n * @type Object\r\n * @property {String} id Unique Ride ID\r\n * @property {String} name The ride's name\r\n * @property {Bool} active Is this ride currently operating?\r\n * @property {Number} wait_time Ride's current queue time\r\n * @property {Number} last_update Last time this Ride has a wait time change (in milliseconds)\r\n */\r\n\r\n/**\r\n * Ride Class\r\n * Each ride object represents one ride at a theme park.\r\n * This object will hold the ride's current state.\r\n * @class\r\n */\r\nclass Ride {\r\n    /**\r\n     * Create a new Ride object\r\n     * @param {Object} options New ride data\r\n     * @param {String} options.ride_id Ride's Unique ID\r\n     * @param {String} options.ride_name Ride name\r\n     */\r\n    constructor(options = {\r\n        ride_id: null,\r\n        ride_name: null\r\n    }) {\r\n        if (!options.ride_id) throw new Error(\"No ride ID supplied to new ride object\");\r\n        if (!options.ride_name || options.ride_name == \"\") throw new Error(\"No ride name supplied to new ride object\");\r\n\r\n        this[s_rideID] = options.ride_id;\r\n        this[s_rideName] = options.ride_name;\r\n\r\n        // by default, rides don't support fastpass\r\n        this[s_fastPassAvailable] = false;\r\n\r\n        // make our own schedule data object!\r\n        this[s_scheduleData] = new Schedule();\r\n    }\r\n\r\n    /**\r\n     * Serialize this object (automatically called by JSON.stringify etc.)\r\n     * @returns {RideData} Current ride state\r\n     */\r\n    toJSON() {\r\n        // try to extract schedule data for this ride\r\n        var openingHours = this[s_scheduleData].GetDate({\r\n            date: Moment(),\r\n        });\r\n\r\n        var jsonData = {\r\n            id: this[s_rideID],\r\n            name: this.Name,\r\n            active: this.Active,\r\n            waitTime: this.WaitTime,\r\n            fastPass: this.FastPass,\r\n            lastUpdate: this.LastUpdate,\r\n            status: this.Status\r\n        };\r\n\r\n        // add opening hours to ride data if we actually have any!\r\n        if (openingHours) {\r\n            jsonData.schedule = openingHours;\r\n        }\r\n\r\n        return jsonData;\r\n    }\r\n\r\n    /** \r\n     * Restore a state from a JSON object\r\n     * Mainly used to restore ride data from cached data\r\n     * @param {RideData} rideData Ride data to restore (ideally created using toJSON)\r\n     */\r\n    fromJSON(rideData) {\r\n        // restore base ride data\r\n        this[s_rideID] = rideData.id;\r\n        this[s_rideName] = rideData.name;\r\n        this[s_lastTimeUpdate] = rideData.lastUpdate;\r\n        this[s_fastPassAvailable] = rideData.fastPass;\r\n\r\n        // .Active is inferred by WaitTime\r\n        if (!rideData.active) {\r\n            // set WaitTime to -1 if the ride isn't active\r\n            this[s_currentWaitTime] = -1;\r\n        } else {\r\n            this[s_currentWaitTime] = rideData.waitTime;\r\n        }\r\n\r\n        // import any schedule data (if we have any)\r\n        if (rideData.schedule) {\r\n            this[s_scheduleData].SetDate(rideData.schedule);\r\n\r\n            // also re-import special schedule data (if we have any)\r\n            if (rideData.schedule.special && rideData.schedule.special.length > 0) {\r\n                for (var i, specialSchedule; specialSchedule = rideData.schedule.special[i++];) {\r\n                    this[s_scheduleData].SetDate({\r\n                        date: specialSchedule.date,\r\n                        openingTime: specialSchedule.openingTime,\r\n                        closingTime: specialSchedule.closingTime,\r\n                        type: specialSchedule.type,\r\n                        specialHours: true\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get this ride's name\r\n     * Note: Will attempt to return in English, but will fallback to park's local locale if English isn't available\r\n     * @type {String}\r\n     */\r\n    get Name() {\r\n        return this[s_rideName];\r\n    }\r\n\r\n    /**\r\n     * Set this ride's wait time\r\n     * @type {Number}\r\n     */\r\n    set WaitTime(value) {\r\n        // check for updated (or brand new) wait time for this ride\r\n        if (this[s_currentWaitTime] === undefined || this[s_currentWaitTime] != value) {\r\n            // update our last updated time to now\r\n            this[s_lastTimeUpdate] = Date.now();\r\n            // update our wait time for this ride\r\n            this[s_currentWaitTime] = value;\r\n        }\r\n\r\n        // value hasn't changed, don't do anything\r\n    }\r\n\r\n    /**\r\n     * Get this ride's current wait time. Will always be >= 0.\r\n     * Use .Active to determine ride's open status\r\n     * @type {Number}\r\n     */\r\n    get WaitTime() {\r\n        // always return positive ints for the wait time, even when inactive or not defined yet\r\n        if (this[s_currentWaitTime] === undefined || this[s_currentWaitTime] < 0) return 0;\r\n\r\n        return this[s_currentWaitTime];\r\n    }\r\n\r\n    /**\r\n     * Set this ride's fast pass availability\r\n     * @type {Boolean}\r\n     */\r\n    set FastPass(value) {\r\n        if (this[s_fastPassAvailable] != value) {\r\n            // update our last updated time to now\r\n            this[s_lastTimeUpdate] = Date.now();\r\n            // update fastpass status\r\n            this[s_fastPassAvailable] = value;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get this ride's fast pass availability\r\n     * @type {Boolean}\r\n     */\r\n    get FastPass() {\r\n        return this[s_fastPassAvailable];\r\n    }\r\n\r\n    /**\r\n     * Is this ride currently running?\r\n     * @type {Boolean}\r\n     */\r\n    get Active() {\r\n        // if we have no data yet, assume ride is inactive\r\n        if (this[s_currentWaitTime] === undefined) return false;\r\n\r\n        return this[s_currentWaitTime] >= 0;\r\n    }\r\n\r\n    /**\r\n     * String status for this ride\r\n     * Can only ever be either \"Operating\", \"Closed\", or \"Refurbishment\"\r\n     * @type {String}\r\n     */\r\n    get Status() {\r\n        // first, check the schedule for non-operating types\r\n        //  refurbishment/closed schedule overrules all other statuses, as this is planned maintenance\r\n        //  i.e, rides don't usually schedule maintenance and then randomly open mid-day \r\n        var todaysSchedule = this.Schedule.GetDate({\r\n            date: Moment()\r\n        });\r\n        if (todaysSchedule && todaysSchedule.type != \"Operating\") {\r\n            return todaysSchedule.type;\r\n        }\r\n\r\n        // otherwise, return a string matching current Active status\r\n        return (this.Active ? \"Operating\" : \"Closed\");\r\n    }\r\n\r\n    /**\r\n     * Get this ride's last wait time update time.\r\n     * Note: Can be undefined\r\n     * @type {Number}\r\n     */\r\n    get LastUpdate() {\r\n        return this[s_lastTimeUpdate];\r\n    }\r\n\r\n    /**\r\n     * Get this ride's schedule object\r\n     * @type {Schedule}\r\n     */\r\n    get Schedule() {\r\n        return this[s_scheduleData];\r\n    }\r\n}\r\n\r\n// export the Ride class\r\nmodule.exports = Ride;"]}